# UAVCrew MCP Gateway Configuration
# Copy this file to .env and customize for your environment
#
# IMPORTANT: Choose ONE auth mode. Do NOT mix JWT and legacy modes.
# Mixing modes causes silent failures (legacy auth succeeds but
# K4 token resolution fails in dynamic mode).

# =============================================================================
# MODE A: JWT + Dynamic Resolver (production, multi-tenant)
# =============================================================================
# Use this mode when:
#   - UAVCrew sends T1 delegation JWTs (signed with K2)
#   - manifest.json has auth.mode: "dynamic" with resolver_path
#   - K4 tokens are resolved per-tenant via the client's resolver endpoint
#
# Required:
#   MCP_JWT_PUBLIC_KEY_PATH  — path to K3 public key (PEM)
#
# NOT needed (leave commented out):
#   MCP_API_KEY              — legacy static key (conflicts with JWT mode)
#   CLIENT_API_TOKEN         — legacy static K4 (dynamic resolver provides K4)

# Path to K3 public key (PEM) for validating T1 delegation JWTs from UAVCrew.
# Generate with: python manage.py generate_delegation_keypair (on UAVCrew)
# MCP_JWT_PUBLIC_KEY_PATH=/etc/mcp-gateway/k3_public.pem

# =============================================================================
# MODE B: Legacy API Key + Static Token (development, single-tenant)
# =============================================================================
# Use this mode when:
#   - No JWT/K2/K3 key pair is configured
#   - manifest.json has auth.mode: "static" (or no auth section)
#   - A single static K4 token is used for all requests
#
# Required:
#   MCP_API_KEY              — static key that UAVCrew sends as Bearer token
#   CLIENT_API_TOKEN         — static K4 for all API calls
#
# NOT needed (leave commented out):
#   MCP_JWT_PUBLIC_KEY_PATH  — not used in legacy mode

# Static API key for authenticating requests from UAVCrew (legacy)
# MCP_API_KEY=your-static-api-key-here

# Client API token (K4) for static auth mode
# MCP_API_TOKEN is resolved dynamically in Mode A; only set this for Mode B
# CLIENT_API_TOKEN=your-client-api-token-here

# =============================================================================
# CLIENT API
# =============================================================================
# Base URL of the client REST API that the gateway forwards requests to.
# The gateway appends entity paths from manifest.json to this URL.
# If not set, falls back to api_base_url in manifest.json.
CLIENT_API_BASE_URL=https://app.ayna.com/api/v1

# =============================================================================
# SERVER
# =============================================================================
# Server identity (shown in UAVCrew dashboard)
MCP_SERVER_NAME=MCP Gateway

# Public HTTPS URL where UAVCrew connects (behind reverse proxy)
MCP_PUBLIC_URL=https://mcp.example.com

# Host to bind to (127.0.0.1 for behind reverse proxy, 0.0.0.0 for all interfaces)
MCP_HOST=127.0.0.1

# Port to listen on
MCP_PORT=8200

# =============================================================================
# LOGGING
# =============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO
